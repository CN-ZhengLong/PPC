<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>带宽收益与成本计算器</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 750px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            text-align: center;
            color: #0056b3;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input[type="number"],
        .input-group select {
            width: calc(100% - 120px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            display: inline-block;
            vertical-align: middle;
        }
        .input-group select {
            width: 100px;
            margin-left: 5px;
        }
        .input-group .half-width {
            width: calc(50% - 10px);
        }
        .input-group .select-group {
            width: calc(50% - 5px); /* Adjusted width to avoid overflow */
            display: inline-block;
            vertical-align: middle;
        }
        /* 硬件成本估算部分的样式 */
        .hardware-cost-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding-left: 10px; /* 缩进一些，与标题对齐 */
        }
        .hardware-cost-item input[type="text"].spec-input {
            flex: 2; /* 描述部分占据更多空间 */
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-right: 10px;
        }
        .hardware-cost-item input[type="number"].price-input {
            width: 80px; /* 价格输入框固定宽度 */
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            text-align: right;
        }
        .hardware-cost-item .unit-label {
            margin: 0 5px;
        }
        .hardware-cost-item input[type="number"].quantity-input {
            width: 60px; /* 数量输入框固定宽度 */
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            text-align: center;
            margin-left: 5px;
        }
        .hardware-cost-item .info-text {
            font-size: 0.9em;
            color: #777;
            margin-left: 10px;
            flex: 1; /* 占据剩余空间 */
        }

        .total-cost-display {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed #eee;
            font-size: 1.1em;
            font-weight: bold;
            text-align: right;
        }
        .total-hardware-cost {
            font-size: 1.2em;
            color: #dc3545;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed #eee;
            text-align: right;
            font-weight: bold;
        }
        .fixed-cost-section {
            background-color: #f9f9f9;
            border: 1px solid #eee;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
        }
        .fixed-cost-section h3 {
            text-align: center;
            color: #0056b3;
            margin-top: 0;
            margin-bottom: 15px;
        }

        button {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .results {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        .results p {
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        .results strong {
            color: #28a745;
            font-size: 1.2em;
        }
        .results .cost-display {
            color: #dc3545;
        }
        .disclaimer {
            font-size: 0.9em;
            color: #666;
            margin-top: 20px;
            text-align: center;
        }
        .warning-message {
            color: #dc3545; /* Red color for warnings */
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
            padding: 5px;
            border: 1px solid #dc3545;
            background-color: #f8d7da;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>带宽收益与成本计算器</h1>
        <p>输入您的带宽贡献数据、宽带与硬件配置，即可估算潜在收益和成本。</p>

        <hr>

        <h2>一次性核心硬件成本估算</h2>
        <p style="font-size: 0.9em; color: #777; margin-bottom: 15px; text-align: center;">
            在此填写您作为核心计算单元的硬件规格、单价和数量。
        </p>

        <div class="hardware-cost-item">
            <input type="text" id="cpuSpec" value="CPU (例如：E5 2683V3 16核)" class="spec-input">
            <input type="number" id="cpuPrice" value="23" step="1" class="price-input" oninput="calculateCoreHardwareCost()">
            <span class="unit-label">元 ×</span>
            <input type="number" id="cpuQuantity" value="1" min="0" class="quantity-input" oninput="calculateCoreHardwareCost()">
            <span class="info-text"></span>
        </div>
        <div class="hardware-cost-item">
            <input type="text" id="ramSpec" value="内存 (例如：DDR4 16G)" class="spec-input">
            <input type="number" id="ramPrice" value="75" step="1" class="price-input" oninput="calculateCoreHardwareCost()">
            <span class="unit-label">元 ×</span>
            <input type="number" id="ramQuantity" value="1" min="0" class="quantity-input" oninput="calculateCoreHardwareCost()">
            <span class="info-text"></span>
        </div>
        <div class="hardware-cost-item">
            <input type="text" id="ssdSpec" value="SSD (例如：HK4R 2T 固态硬盘)" class="spec-input">
            <input type="number" id="ssdPrice" value="539" step="1" class="price-input" oninput="calculateCoreHardwareCost()">
            <span class="unit-label">元 ×</span>
            <input type="number" id="ssdQuantity" value="1" min="0" class="quantity-input" oninput="calculateCoreHardwareCost()">
            <span class="info-text"></span>
        </div>
        <div class="hardware-cost-item">
            <input type="text" id="hddSpec" value="HDD (例如：SAS 6T 硬盘)" class="spec-input">
            <input type="number" id="hddPrice" value="279" step="1" class="price-input" oninput="calculateCoreHardwareCost()">
            <span class="unit-label">元 ×</span>
            <input type="number" id="hddQuantity" value="2" min="0" class="quantity-input" oninput="calculateCoreHardwareCost()">
            <span class="info-text"></span>
        </div>
        
        <div class="total-hardware-cost">
            核心硬件投入: <strong class="cost-display" id="totalCoreHardwareCostDisplay">0.00 元</strong>
        </div>

        <hr>

        <h2>固定一次性投入</h2>
        <p style="font-size: 0.9em; color: #777; margin-bottom: 15px; text-align: center;">
            这些是无论核心配置如何，都需要一次性支付的基础设施成本。
        </p>
        <div class="fixed-cost-section">
            <div class="hardware-cost-item">
                <input type="text" id="broadbandInstallSpec" value="单条宽带安装费" class="spec-input" readonly>
                <input type="number" id="broadbandInstallPrice" value="100" step="1" class="price-input" oninput="calculateFixedOneTimeCost()">
                <span class="unit-label">元 ×</span>
                <input type="number" id="broadbandInstallQuantity" value="1" min="0" class="quantity-input" readonly style="background-color: #f0f0f0;">
                <span class="info-text">(数量根据贡献带宽和单条宽带速度自动估算)</span>
            </div>
            <div class="hardware-cost-item">
                <input type="text" id="caseSpec" value="机箱 (例如：2U)" class="spec-input">
                <input type="number" id="casePrice" value="50" step="1" class="price-input" oninput="calculateFixedOneTimeCost()">
                <span class="unit-label">元 ×</span>
                <input type="number" id="caseQuantity" value="1" min="0" class="quantity-input" oninput="calculateFixedOneTimeCost()">
                <span class="info-text"></span>
            </div>
            <div class="hardware-cost-item">
                <input type="text" id="nicSpec" value="网卡 (例如：万兆 OCP 网卡)" class="spec-input">
                <input type="number" id="nicPrice" value="13" step="1" class="price-input" oninput="calculateFixedOneTimeCost()">
                <span class="unit-label">元 ×</span>
                <input type="number" id="nicQuantity" value="1" min="0" class="quantity-input" oninput="calculateFixedOneTimeCost()">
                <span class="info-text"></span>
            </div>
            <div class="hardware-cost-item">
                <input type="text" id="motherboardSpec" value="主板 (例如：RD452X)" class="spec-input">
                <input type="number" id="motherboardPrice" value="176" step="1" class="price-input" oninput="calculateFixedOneTimeCost()">
                <span class="unit-label">元 ×</span>
                <input type="number" id="motherboardQuantity" value="1" min="0" class="quantity-input" oninput="calculateFixedOneTimeCost()">
                <span class="info-text"></span>
            </div>
            <div class="hardware-cost-item">
                <input type="text" id="psuSpec" value="电源 (例如：500W)" class="spec-input">
                <input type="number" id="psuPrice" value="200" step="1" class="price-input" oninput="calculateFixedOneTimeCost()">
                <span class="unit-label">元 ×</span>
                <input type="number" id="psuQuantity" value="1" min="0" class="quantity-input" oninput="calculateFixedOneTimeCost()">
                <span class="info-text"></span>
            </div>
            <div class="hardware-cost-item">
                <input type="text" id="switchSpec" value="交换机 (例如：思科4948e)" class="spec-input">
                <input type="number" id="switchPrice" value="430" step="1" class="price-input" oninput="calculateFixedOneTimeCost()">
                <span class="unit-label">元 ×</span>
                <input type="number" id="switchQuantity" value="0" min="0" class="quantity-input" oninput="calculateFixedOneTimeCost()">
                <span class="info-text"></span>
            </div>
            <div class="hardware-cost-item">
                <input type="text" id="ethernetCableSpec" value="网线" class="spec-input">
                <input type="number" id="ethernetCablePrice" value="10" step="1" class="price-input" oninput="calculateFixedOneTimeCost()">
                <span class="unit-label">元 ×</span>
                <input type="number" id="ethernetCableQuantity" value="5" min="0" class="quantity-input" oninput="calculateFixedOneTimeCost()">
                <span class="info-text"></span>
            </div>
            <div class="hardware-cost-item">
                <input type="text" id="hddCageSpec" value="硬盘笼" class="spec-input">
                <input type="number" id="hddCagePrice" value="80" step="1" class="price-input" oninput="calculateFixedOneTimeCost()">
                <span class="unit-label">元 ×</span>
                <input type="number" id="hddCageQuantity" value="0" min="0" class="quantity-input" oninput="calculateFixedOneTimeCost()">
                <span class="info-text"></span>
            </div>
            <div class="total-hardware-cost">
                固定一次性投入: <strong class="cost-display" id="totalFixedOneTimeCostDisplay">0.00 元</strong>
            </div>
        </div>

        <hr>

        <h2>带宽收益估算</h2>

        <div class="input-group">
            <label for="bandwidth">贡献带宽:</label>
            <input type="number" id="bandwidth" placeholder="例如：100" step="0.1" oninput="validateConfigLimits()">
            <select id="bandwidthUnit" onchange="validateConfigLimits()">
                <option value="Mbps">Mbps</option>
                <option value="Gbps">Gbps</option>
            </select>
            <p style="font-size: 0.9em; color: #777;">您的平均上传带宽或可提供带宽。</p>
            <div id="bandwidthLimitWarning" class="warning-message" style="display:none;">
                注意：单台机器最大支持 6Gbps 带宽，您的输入已超出！
            </div>
        </div>

        <div class="input-group">
            <label for="price">带宽单价:</label>
            <input type="number" id="price" placeholder="例如：0.05" step="0.001" class="half-width">
            <div class="select-group">
                <select id="priceBandwidthUnit" style="width: calc(50% - 5px);">
                    <option value="Mbps">Mbps</option>
                    <option value="Gbps">Gbps</option>
                </select>
                <select id="priceTimeUnit" style="width: calc(50% - 5px); margin-left: 5px;">
                    <option value="month">/月</option>
                    <option value="day">/天</option>
                </select>
            </div>
            <p style="font-size: 0.9em; color: #777;">根据平台公布的计费标准。</p>
        </div>

        <div class="input-group">
            <label>平均在线时长 (小时/天):</label>
            <p style="font-size: 1.1em; font-weight: bold; color: #0056b3;">24 小时 (默认值)</p>
            <p style="font-size: 0.9em; color: #777;">本计算器默认设备每天在线 24 小时。</p>
        </div>

        <hr>

        <h2>宽带成本估算</h2>
        <div class="input-group">
            <label for="broadbandSpeed">您单条宽带的下载速度:</label>
            <input type="number" id="broadbandSpeed" placeholder="例如：100" step="1">
            <select id="broadbandSpeedUnit">
                <option value="Mbps">Mbps</option>
                <option value="Gbps">Gbps</option>
            </select>
            <p style="font-size: 0.9em; color: #777;">您单个宽带套餐的实际速度。</p>
        </div>
        <div class="input-group">
            <label for="broadbandCost">您单条宽带的月租费 (元):</label>
            <input type="number" id="broadbandCost" placeholder="例如：40" step="0.1">
            <p style="font-size: 0.9em; color: #777;">您每月为单条宽带支付的费用。</p>
        </div>
        <div class="total-cost-display">
            为了贡献 **<span id="displayContributionBandwidth">0</span>**，理论上需要约 <strong><span id="broadbandQuantityNeeded">0</span></strong> 条宽带。
        </div>
        <div class="total-cost-display">
            预估月度宽带成本: <strong class="cost-display" id="estimatedBroadbandCost">0.00 元</strong>
            <p style="font-size: 0.8em; color: #777; font-weight: normal;">(根据贡献带宽和单条宽带速度分摊)</p>
        </div>

        <button onclick="calculateRevenueAndCost()">计算总览</button>

        <hr>

        <h2>计算结果总览</h2>
        <div class="results">
            <p>月度预估收益: <strong><span id="finalMonthlyRevenue">0.00 元</span></strong></p>
            <p>年度预估收益: <strong><span id="finalAnnualRevenue">0.00 元</span></strong></p>
            <p>月度预估宽带成本: <strong class="cost-display"><span id="finalBroadbandCost">0.00 元</span></strong></p>
            <p>总一次性投入: <strong class="cost-display"><span id="finalTotalOneTimeCost">0.00 元</span></strong></p>
            <p style="font-size: 0.9em; color: #777;">（总一次性投入包括核心硬件和固定基础设施成本，未计入月度或年度净收益中）</p>
            <div id="overallLimitWarning" class="warning-message" style="display:none;">
                <p><strong>警告：</strong>您当前的配置可能超出单台机器的理论最大承载能力！</p>
                <ul style="text-align: left; margin-left: 20px;">
                    <li id="overallBandwidthWarning" style="display:none;">带宽超出 6Gbps 限制。</li>
                    <li id="overallDriveSlotsWarning" style="display:none;">硬盘盘位超出 12 个限制。</li>
                </ul>
                <p style="font-size: 0.8em; margin-top: 5px;">请考虑降低带宽或硬盘配置，或使用多台机器来满足需求。</p>
            </div>
        </div>

        <p class="disclaimer">
            以上结果为估算值，实际收益和成本可能因平台策略、网络波动、资源利用率、硬件市场价格波动、宽带安装费用差异等因素有所差异。请以实际结算和采购价格为准。
        </p>
    </div>

    <script>
        // 定义单台机器的配置上限
        const MAX_BANDWIDTH_GBPS = 6; // 最大带宽 6Gbps
        const MAX_DRIVE_SLOTS = 12;   // 最大盘位 12个
        const HDD_CAPACITY_PER_SLOT_TB = 6; // 机械硬盘每个盘位 6TB
        const SSD_CAPACITY_PER_SLOT_TB = 2; // 固态硬盘每个盘位 2TB (根据用户提供的信息，固态硬盘容量虽然小，但仍占一个盘位)

        // 定义核心硬件项目及其默认值
        const CORE_HARDWARE_ITEMS = [
            { id: 'cpu', spec: 'CPU (例如：E5 2683V3 16核)', defaultPrice: 23, defaultQuantity: 1 },
            { id: 'ram', spec: '内存 (例如：DDR4 16G)', defaultPrice: 75, defaultQuantity: 1 },
            { id: 'ssd', spec: 'SSD (例如：HK4R 2T 固态硬盘)', defaultPrice: 539, defaultQuantity: 1 },
            { id: 'hdd', spec: 'HDD (例如：SAS 6T 硬盘)', defaultPrice: 279, defaultQuantity: 2 } // 默认2块6T硬盘，表示12T存储
        ];

        // 定义固定一次性投入项目及其默认值
        const FIXED_ONE_TIME_ITEMS = [
            { id: 'broadbandInstall', spec: '单条宽带安装费', defaultPrice: 100, defaultQuantity: 1, isQuantityCalculated: true },
            { id: 'case', spec: '机箱 (例如：2U)', defaultPrice: 50, defaultQuantity: 1 },
            { id: 'nic', spec: '网卡 (例如：万兆 OCP 网卡)', defaultPrice: 13, defaultQuantity: 1 },
            { id: 'motherboard', spec: '主板 (例如：RD452X)', defaultPrice: 176, defaultQuantity: 1 },
            { id: 'psu', spec: '电源 (例如：500W)', defaultPrice: 200, defaultQuantity: 1 },
            { id: 'switch', spec: '交换机 (例如：思科4948e)', defaultPrice: 430, defaultQuantity: 0 },
            { id: 'ethernetCable', spec: '网线', defaultPrice: 10, defaultQuantity: 5 },
            { id: 'hddCage', spec: '硬盘笼', defaultPrice: 80, defaultQuantity: 0 }
        ];

        // 页面加载时绑定事件和初始化显示
        document.addEventListener('DOMContentLoaded', (event) => {
            // 初始化核心硬件项目的默认值并绑定事件
            CORE_HARDWARE_ITEMS.forEach(item => {
                const specInput = document.getElementById(`${item.id}Spec`);
                const priceInput = document.getElementById(`${item.id}Price`);
                const quantityInput = document.getElementById(`${item.id}Quantity`);

                if (specInput) specInput.value = item.spec;
                if (priceInput) priceInput.value = item.defaultPrice;
                if (quantityInput) quantityInput.value = item.defaultQuantity;

                if (specInput) specInput.addEventListener('input', () => { calculateCoreHardwareCost(); validateConfigLimits(); });
                if (priceInput) priceInput.addEventListener('input', () => { calculateCoreHardwareCost(); validateConfigLimits(); });
                if (quantityInput) quantityInput.addEventListener('input', () => { calculateCoreHardwareCost(); validateConfigLimits(); });
            });

            // 初始化固定一次性投入项目的默认值并绑定事件
            FIXED_ONE_TIME_ITEMS.forEach(item => {
                const specInput = document.getElementById(`${item.id}Spec`);
                const priceInput = document.getElementById(`${item.id}Price`);
                const quantityInput = document.getElementById(`${item.id}Quantity`);

                if (specInput) specInput.value = item.spec;
                if (priceInput) priceInput.value = item.defaultPrice;
                if (quantityInput) {
                    quantityInput.value = item.defaultQuantity;
                    if (item.isQuantityCalculated) {
                        quantityInput.readOnly = true; // 宽带安装费数量只读
                        quantityInput.style.backgroundColor = '#f0f0f0'; // 灰色背景
                    }
                }

                if (specInput) specInput.addEventListener('input', calculateFixedOneTimeCost);
                if (priceInput) priceInput.addEventListener('input', calculateFixedOneTimeCost);
                if (quantityInput && !item.isQuantityCalculated) {
                    quantityInput.addEventListener('input', calculateFixedOneTimeCost);
                }
            });

            // 宽带成本和贡献带宽相关的输入框绑定事件，确保宽带成本、安装费和所需条数的实时计算和限制验证
            document.getElementById('broadbandSpeed').addEventListener('input', updateBroadbandCostsAndInstallFee);
            document.getElementById('broadbandSpeedUnit').addEventListener('change', updateBroadbandCostsAndInstallFee);
            document.getElementById('broadbandCost').addEventListener('input', updateBroadbandCostsAndInstallFee);
            document.getElementById('bandwidth').addEventListener('input', updateBroadbandCostsAndInstallFee);
            document.getElementById('bandwidthUnit').addEventListener('change', updateBroadbandCostsAndInstallFee);

            // 页面加载时先计算一次初始成本和验证
            updateBroadbandCostsAndInstallFee(); // 先更新宽带相关的成本和安装费数量
            calculateCoreHardwareCost(); // 计算核心硬件成本
            calculateFixedOneTimeCost(); // 计算固定一次性投入
            validateConfigLimits(); // 初始验证配置限制
        });

        // 综合更新宽带相关的成本（月租费和安装费数量），并更新所需宽带条数显示
        function updateBroadbandCostsAndInstallFee() {
            calculateBroadbandMonthlyCost(); // 计算月租成本

            // 更新宽带安装费的数量
            const broadbandSpeed = parseFloat(document.getElementById('broadbandSpeed').value);
            const broadbandSpeedUnit = document.getElementById('broadbandSpeedUnit').value;
            const contributionBandwidth = parseFloat(document.getElementById('bandwidth').value);
            const contributionBandwidthUnit = document.getElementById('bandwidthUnit').value;

            let actualBroadbandSpeedMbps = broadbandSpeed;
            if (broadbandSpeedUnit === 'Gbps') {
                actualBroadbandSpeedMbps = broadbandSpeed * 1024; // Gbps 转换为 Mbps
            }

            let actualContributionBandwidthMbps = contributionBandwidth;
            if (contributionBandwidthUnit === 'Gbps') {
                actualContributionBandwidthMbps = contributionBandwidth * 1024; // Gbps 转换为 Mbps
            }

            let numberOfBroadbandsNeeded = 0;
            if (actualBroadbandSpeedMbps > 0 && actualContributionBandwidthMbps > 0) {
                numberOfBroadbandsNeeded = Math.ceil(actualContributionBandwidthMbps / actualBroadbandSpeedMbps);
            } else if (actualContributionBandwidthMbps > 0) {
                // 如果单条宽带速度为0但有贡献带宽，则至少算1条
                numberOfBroadbandsNeeded = 1;
            }
            document.getElementById('broadbandQuantityNeeded').innerText = numberOfBroadbandsNeeded;
            document.getElementById('displayContributionBandwidth').innerText = `${contributionBandwidth || 0} ${contributionBandwidthUnit}`;

            // 更新宽带安装费的实际数量输入框
            const broadbandInstallQuantityInput = document.getElementById('broadbandInstallQuantity');
            if (broadbandInstallQuantityInput) {
                broadbandInstallQuantityInput.value = numberOfBroadbandsNeeded;
            }

            calculateFixedOneTimeCost(); // 数量变化后重新计算固定一次性成本
            validateConfigLimits(); // 带宽和宽带数量变化时也验证限制
        }

        // 独立计算宽带月度成本的函数
        function calculateBroadbandMonthlyCost() {
            const broadbandSpeed = parseFloat(document.getElementById('broadbandSpeed').value);
            const broadbandSpeedUnit = document.getElementById('broadbandSpeedUnit').value;
            const broadbandMonthlyCost = parseFloat(document.getElementById('broadbandCost').value);
            const contributionBandwidth = parseFloat(document.getElementById('bandwidth').value);
            const contributionBandwidthUnit = document.getElementById('bandwidthUnit').value;

            if (isNaN(broadbandSpeed) || isNaN(broadbandMonthlyCost) || broadbandMonthlyCost < 0) {
                document.getElementById('estimatedBroadbandCost').innerText = "0.00 元";
                return 0;
            }

            let actualBroadbandSpeedMbps = broadbandSpeed;
            if (broadbandSpeedUnit === 'Gbps') {
                actualBroadbandSpeedMbps = broadbandSpeed * 1024; // Gbps 转换为 Mbps
            }

            let actualContributionBandwidthMbps = contributionBandwidth;
            if (contributionBandwidthUnit === 'Gbps') {
                actualContributionBandwidthMbps = contributionBandwidth * 1024; // Gbps 转换为 Mbps
            }

            let calculatedBroadbandCost = 0;
            let numberOfBroadbandsNeeded = 0;

            if (actualBroadbandSpeedMbps > 0 && actualContributionBandwidthMbps > 0) {
                // 计算需要多少条宽带才能承载贡献带宽
                numberOfBroadbandsNeeded = Math.ceil(actualContributionBandwidthMbps / actualBroadbandSpeedMbps);
            } else if (actualContributionBandwidthMbps > 0) {
                 // 如果单条宽带速度为0但有贡献带宽，则视为至少需要1条
                numberOfBroadbandsNeeded = 1;
            }

            // 月租费按需要的宽带数量倍增
            calculatedBroadbandCost = broadbandMonthlyCost * numberOfBroadbandsNeeded;

            document.getElementById('estimatedBroadbandCost').innerText = calculatedBroadbandCost.toFixed(2) + " 元";
            return calculatedBroadbandCost;
        }

        // 计算核心硬件成本
        function calculateCoreHardwareCost() {
            let totalCost = 0;
            CORE_HARDWARE_ITEMS.forEach(item => {
                const priceInput = document.getElementById(`${item.id}Price`);
                const quantityInput = document.getElementById(`${item.id}Quantity`);

                const price = parseFloat(priceInput.value) || 0;
                const quantity = parseInt(quantityInput.value) || 0;
                totalCost += price * quantity;
            });
            document.getElementById('totalCoreHardwareCostDisplay').innerText = totalCost.toFixed(2) + " 元";
            return totalCost;
        }

        // 计算固定一次性投入
        function calculateFixedOneTimeCost() {
            let totalCost = 0;
            FIXED_ONE_TIME_ITEMS.forEach(item => {
                const priceInput = document.getElementById(`${item.id}Price`);
                const quantityInput = document.getElementById(`${item.id}Quantity`);

                const price = parseFloat(priceInput.value) || 0;
                const quantity = parseInt(quantityInput.value) || 0;
                totalCost += price * quantity;
            });
            document.getElementById('totalFixedOneTimeCostDisplay').innerText = totalCost.toFixed(2) + " 元";
            return totalCost;
        }

        // 验证单台机器配置上限的函数
        function validateConfigLimits() {
            let bandwidthExceeded = false;
            let driveSlotsExceeded = false;

            // 1. 验证带宽
            const bandwidth = parseFloat(document.getElementById('bandwidth').value);
            const bandwidthUnit = document.getElementById('bandwidthUnit').value;
            let actualBandwidthGbps = bandwidth;
            if (bandwidthUnit === 'Mbps') {
                actualBandwidthGbps = bandwidth / 1024; // Mbps 转换为 Gbps
            }
            if (actualBandwidthGbps > MAX_BANDWIDTH_GBPS) {
                bandwidthExceeded = true;
            }

            // 2. 验证硬盘盘位
            const ssdQuantity = parseInt(document.getElementById('ssdQuantity').value) || 0;
            const hddQuantity = parseInt(document.getElementById('hddQuantity').value) || 0;
            const totalDriveSlots = ssdQuantity + hddQuantity;

            if (totalDriveSlots > MAX_DRIVE_SLOTS) {
                driveSlotsExceeded = true;
            }

            // 更新页面上的警告信息 (在贡献带宽下方)
            const bandwidthWarningDiv = document.getElementById('bandwidthLimitWarning');
            if (bandwidthExceeded) {
                bandwidthWarningDiv.style.display = 'block';
            } else {
                bandwidthWarningDiv.style.display = 'none';
            }

            // 更新最终结果区域的警告信息
            const overallLimitWarningDiv = document.getElementById('overallLimitWarning');
            const overallBandwidthWarningLi = document.getElementById('overallBandwidthWarning');
            const overallDriveSlotsWarningLi = document.getElementById('overallDriveSlotsWarning');

            if (bandwidthExceeded || driveSlotsExceeded) {
                overallLimitWarningDiv.style.display = 'block';
                overallBandwidthWarningLi.style.display = bandwidthExceeded ? 'list-item' : 'none';
                overallDriveSlotsWarningLi.style.display = driveSlotsExceeded ? 'list-item' : 'none';
            } else {
                overallLimitWarningDiv.style.display = 'none';
            }
        }


        // 综合计算收益和成本的函数
        function calculateRevenueAndCost() {
            validateConfigLimits(); // 再次验证配置限制，确保结果总览部分显示最新警告

            // --- 收益计算部分 ---
            const bandwidth = parseFloat(document.getElementById('bandwidth').value);
            const bandwidthUnit = document.getElementById('bandwidthUnit').value; // 'Mbps' or 'Gbps'
            const price = parseFloat(document.getElementById('price').value);
            const priceBandwidthUnit = document.getElementById('priceBandwidthUnit').value; // 'Mbps' or 'Gbps'
            const priceTimeUnit = document.getElementById('priceTimeUnit').value; // 'month' or 'day'

            // 输入验证
            if (isNaN(bandwidth) || isNaN(price)) {
                alert("请确保 '贡献带宽' 和 '带宽单价' 都已正确填写数字！");
                return;
            }

            let actualBandwidthMbps = bandwidth;
            if (bandwidthUnit === 'Gbps') {
                actualBandwidthMbps = bandwidth * 1024; // Gbps 转换为 Mbps
            }

            let actualPricePerMbpsPerMonth = price;
            // 将单价统一转换为 元/Mbps/月
            if (priceBandwidthUnit === 'Gbps') {
                actualPricePerMbpsPerMonth = actualPricePerMbpsPerMonth / 1024; // Gbps 单价转换为 Mbps 单价
            }
            if (priceTimeUnit === 'day') {
                actualPricePerMbpsPerMonth = actualPricePerMbpsPerMonth * 30; // 天单价转换为月单价（按30天计算）
            }

            // 平均在线时长固定为 24 小时，即在线比例为 1
            const onlineRatio = 1;

            // 估算月度总收益
            const estimatedMonthlyRevenue = actualBandwidthMbps * actualPricePerMbpsPerMonth * onlineRatio;

            // --- 成本计算部分 ---
            const totalCoreHardwareCost = calculateCoreHardwareCost();
            const totalFixedOneTimeCost = calculateFixedOneTimeCost();
            const totalOverallOneTimeCost = totalCoreHardwareCost + totalFixedOneTimeCost; // 总的一次性投入
            const monthlyBroadbandCost = calculateBroadbandMonthlyCost(); // 调用宽带月度成本计算函数

            // --- 更新页面显示 ---
            document.getElementById('finalMonthlyRevenue').innerText = estimatedMonthlyRevenue.toFixed(2) + " 元";
            document.getElementById('finalAnnualRevenue').innerText = (estimatedMonthlyRevenue * 12).toFixed(2) + " 元";
            document.getElementById('finalBroadbandCost').innerText = monthlyBroadbandCost.toFixed(2) + " 元";
            document.getElementById('finalTotalOneTimeCost').innerText = totalOverallOneTimeCost.toFixed(2) + " 元";
        }
    </script>
</body>
</html>
